/* ===== 美化模板 · 山海月影 · 读得清 & 更稳帧 ===== */

/* 主题变量 */
:root {
  --ink: #0E1A1F;
  /* 深墨：提高对比 */
  --mist: #8FB4C9;
  --paper: #F6F7F9;
  --verm: #D64545;
  --gold: #d7b87b;
  --jade: #1d4e57;

  /* 卡片与区块 */
  --card-bg: rgba(255, 255, 255, 0.245);
  /* 整体更实 */
  --panel-bg: rgba(255, 255, 255, .94);
  /* 区块背板更亮，读字兜底 */
  --panel-border: 1px solid rgba(29, 78, 87, .28);

  --glass: blur(6px) saturate(110%);
  --shadow: 0 10px 30px rgba(0, 0, 0, .25);

  /* 背景暗化渐变（不挡细节） */
  --scrim-top: rgba(2, 8, 10, .50);
  --scrim-mid: rgba(2, 8, 10, .34);
  --scrim-btm: rgba(2, 8, 10, .56);
}

/* 基础排版 */
html {
  font-size: clamp(16px, 0.95vw + 0.7vh, 19px)
}

* {
  box-sizing: border-box
}

html,
body {
  height: 100%
}

body {
  margin: 0;
  color: var(--ink);
  background: #000;
  font-family: "Source Han Serif SC", "Noto Serif SC", "Songti SC", "STSong", serif;
  line-height: 1.8;
  overflow-x: hidden;
  position: relative;
}

/* 背景视频 */
.bg-video {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: -6;
  /* 不加任何滤镜，省 GPU */
}

/* 背景暗化遮罩 */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -5;
  background:
    radial-gradient(1100px 540px at 50% 12%, rgba(255, 255, 255, .03), transparent 60%),
    linear-gradient(to bottom, var(--scrim-top), var(--scrim-mid) 40%, var(--scrim-btm));
}

/* 全局动效（精简） */
.fx {
  position: fixed;
  inset: 0;
  pointer-events: none
}

.fx-clouds {
  background:
    radial-gradient(900px 420px at 30% 20%, rgba(255, 255, 255, .10), transparent 60%),
    radial-gradient(820px 380px at 70% 30%, rgba(255, 255, 255, .07), transparent 60%);
  mix-blend-mode: screen;
  opacity: .26;
  animation: cloudShift 180s linear infinite;
  z-index: -4;
  transform: translateZ(0);
}

.fx-clouds.front {
  display: none
}

@keyframes cloudShift {
  50% {
    transform: translate3d(-2%, 1%, 0)
  }
}

.fx-moon {
  background: radial-gradient(520px 520px at 75% 12%, rgba(255, 255, 240, .10), transparent 60%);
  animation: moonPulse 18s ease-in-out infinite;
  z-index: -3;
}

@keyframes moonPulse {

  0%,
  100% {
    opacity: .24
  }

  50% {
    opacity: .40
  }
}

.fx-water {
  background: linear-gradient(to top, rgba(255, 255, 255, .06), rgba(255, 255, 255, 0));
  z-index: -2;
  opacity: .14;
  animation: waterBreath 7s ease-in-out infinite;
}

@keyframes waterBreath {
  50% {
    filter: blur(0.8px)
  }
}

/* 轻噪点（静态） */
.fx-grain {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIUlEQVQoU2NkYGD4z0ABYBQjA2NgYGAQGJgYhMRAKc0BB4AAG4kA3xN5c8EAAAAAElFTkSuQmCC");
  background-size: 10px 10px;
  opacity: .08;
  z-index: -1;
}

.fx-petals {
  z-index: -1;
  overflow: hidden
}

@keyframes fall {
  0% {
    transform: translateY(-10vh) rotate(var(--r, 0)) scale(1)
  }

  100% {
    transform: translateY(110vh) rotate(calc(var(--r, 0) + 60deg)) scale(.95);
    opacity: .0
  }
}

@keyframes sway {

  0%,
  100% {
    transform: translateX(0) rotate(0deg)
  }

  50% {
    transform: translateX(6vw) rotate(8deg)
  }
}

/* 中央卡片 */
.card {
  position: relative;
  margin: 6vh auto 10vh;
  width: min(88vw, 880px);
  max-width: 880px;
  filter: drop-shadow(var(--shadow));
}

/* 只在整张卡片做一次 blur，性能稳，读字不受背景干扰 */
.card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 18px;
  z-index: -1;
  pointer-events: none;
  backdrop-filter: var(--glass);
}

.card-frame {
  position: relative;
  border-radius: 18px;
  background: var(--card-bg);
  border: 1px solid rgba(215, 184, 123, .32);
  overflow: hidden;
}

/* 金线流光边框（减速） */
.card-frame::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 18px;
  pointer-events: none;
  padding: 1px;
  background: linear-gradient(120deg, rgba(215, 184, 123, 0), rgba(215, 184, 123, .6), rgba(215, 184, 123, 0));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  animation: borderSweep 22s linear infinite;
}

@keyframes borderSweep {
  100% {
    background-position: 200% 200%
  }
}

/* 区块：更厚的“读字背板”（模拟毛玻璃，不用每区块 blur） */
.block {
  position: relative;
  padding: 2.2rem 2rem;
  z-index: 0;
  contain: layout paint;
}

.block+.block {
  border-top: 1px dashed rgba(215, 184, 123, .28)
}

.block::before {
  content: "";
  position: absolute;
  inset: 10px;
  border-radius: 12px;
  z-index: 0;
  background: var(--panel-bg);
  box-shadow: inset 0 0 0 1px rgba(29, 78, 87, .26);
}

@supports not ((backdrop-filter: blur(1px))) {
  .card::before {
    backdrop-filter: none
  }

  /* 老浏览器不做卡片级 blur */
}

.block>* {
  position: relative;
  z-index: 1
}

/* 文字阴影：轻微提边，防花底吞字 */
.block,
.block p,
.block li {
  text-shadow: 0 1px 1px rgba(255, 255, 255, .25), 0 -1px 1px rgba(0, 0, 0, .08);
}

/* 场景渲染 */
.scene {
  background: linear-gradient(to bottom, rgba(255, 255, 255, .14), rgba(255, 255, 255, .05))
}

.scene-meta {
  display: flex;
  gap: .8rem;
  align-items: center;
  font-size: .9rem;
  opacity: .95
}

.scene-meta .stamp {
  margin-left: auto;
  font-size: .85rem;
  letter-spacing: .3em;
  color: #fff;
  background: var(--verm);
  padding: .2em .6em;
  border-radius: 2px;
}

.scene-text {
  margin: .8rem 0 0
}

/* 旁白与墨线（缓速） */
.narrator .dropcap::first-letter {
  font-size: 1.6em;
  margin-right: .2em;
  color: var(--verm)
}

.ink-line {
  height: 2px;
  background: linear-gradient(90deg, rgba(29, 78, 87, 0), rgba(29, 78, 87, .85), rgba(29, 78, 87, 0));
  margin-top: 1rem;
  animation: inkGrow 12s ease-in-out infinite;
}

@keyframes inkGrow {
  50% {
    transform: scaleX(1);
    opacity: 1
  }
}

/* 动态事件区 */
.event-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: .6rem
}

.event {
  position: relative;
  padding: .6rem .9rem .6rem 2.2rem;
  border: 1px solid rgba(143, 180, 201, .65);
  border-radius: 8px;
  background: rgba(255, 255, 255, .12);
}

.event i {
  position: absolute;
  left: .6rem;
  top: 50%;
  transform: translateY(-50%);
  width: 1.1rem;
  height: 1.1rem;
  border-radius: 2px;
  background: linear-gradient(135deg, rgba(143, 180, 201, .9), rgba(255, 255, 255, .2));
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .35);
}

.event.promo {
  border-color: rgba(214, 69, 69, .7)
}

.event.promo i {
  background: linear-gradient(135deg, rgba(214, 69, 69, .9), rgba(255, 255, 255, .2))
}

.event.chance {
  border-color: rgba(215, 184, 123, .8);
  background-image: linear-gradient(90deg, rgba(215, 184, 123, .0), rgba(215, 184, 123, .25), rgba(215, 184, 123, 0));
  background-size: 200% 100%;
  animation: slowSweep 10s linear infinite;
}

@keyframes slowSweep {
  0% {
    background-position: -100% 0
  }

  100% {
    background-position: 100% 0
  }
}

/* 行动选项 */
.action-tags {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: .6rem
}

.action-tags li {
  padding: .45rem .8rem;
  border: 1px dashed rgba(29, 78, 87, .32);
  border-radius: 6px;
  background: linear-gradient(0deg, rgba(255, 255, 255, .22), rgba(255, 255, 255, .06));
  position: relative;
  overflow: hidden;
}

.action-tags li::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(120deg, rgba(215, 184, 123, 0), rgba(215, 184, 123, .22), rgba(215, 184, 123, 0));
  opacity: 0;
  animation: brush 14s ease-in-out infinite;
}

@keyframes brush {
  35% {
    opacity: .55
  }

  50% {
    transform: translateX(0)
  }

  65% {
    opacity: .55
  }
}

/* ===== 状态信息：专用高对比面板 + 不遮字进度条 ===== */
.block.stats {
  --panel-bg: rgba(255, 255, 255, .96)
}

.block.stats,
.block.stats * {
  color: #0B1417
}

.stat-bars {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: .7rem
}

.stat-bars li {
  --p: 0%;
  position: relative;
  padding: .5rem .7rem .55rem;
  border-radius: 8px;
  border: 1px solid rgba(29, 78, 87, .28);
  background:
    linear-gradient(90deg, rgba(29, 78, 87, .62), rgba(29, 78, 87, .36)) left/var(--p) 100% no-repeat,
    linear-gradient(0deg, rgba(255, 255, 255, .22), rgba(255, 255, 255, .06));
}

.stat-bars li::after {
  content: none !important
}

.stat-bars li::before {
  content: attr(data-label) " ";
  opacity: .98;
  margin-right: .5rem;
  font-weight: 700;
  color: #0B1417;
}

.stat-bars li .val {
  font-weight: 700;
  color: #0B1417;
  margin-left: .25rem;
  opacity: 1 !important;
}

/* 右侧状态栏 */
.sidebar {
  position: fixed;
  top: 0;
  right: 0;
  height: 100%;
  width: min(86vw, 360px);
  transform: translateX(100%);
  transition: transform .28s ease, box-shadow .28s ease;
  background: rgba(8, 18, 22, .80);
  color: #eef2f4;
  backdrop-filter: blur(10px) saturate(110%);
  border-left: 1px solid rgba(215, 184, 123, .30);
  z-index: 20;
  overflow: auto;
}

.sidebar.open {
  transform: none;
  box-shadow: -20px 0 40px rgba(0, 0, 0, .35)
}

.sidebar-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1rem .6rem
}

.sidebar-head .title {
  letter-spacing: .25em
}

.sidebar-close {
  border: 0;
  background: transparent;
  color: #fff;
  font-size: 1.6rem;
  line-height: 1;
  cursor: pointer
}

.sidebar-body {
  padding: 0 1rem 1.2rem
}

.kv {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: .2rem
}

.kv li {
  display: flex;
  justify-content: space-between;
  padding: .4rem .6rem;
  border-bottom: 1px dashed rgba(255, 255, 255, .15)
}

.kv span {
  opacity: .86
}

/* 滚动条 */
.sidebar {
  scrollbar-width: thin;
  scrollbar-color: rgba(215, 184, 123, .6) rgba(255, 255, 255, .06)
}

.sidebar::-webkit-scrollbar {
  width: 10px
}

.sidebar::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, .06)
}

.sidebar::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, rgba(215, 184, 123, .85), rgba(215, 184, 123, .55));
  border-radius: 8px;
  border: 2px solid rgba(255, 255, 255, .06);
}

/* 右侧触发按钮：玉笛 */
.sidebar-toggle {
  position: fixed;
  top: 16px;
  right: 16px;
  z-index: 25;
  width: 40px;
  height: 120px;
  border: 0;
  background: transparent;
  cursor: pointer;
}

.sidebar-toggle .flute {
  display: block;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  background:
    radial-gradient(circle at 50% 14%, rgba(214, 69, 69, .9), transparent 28%),
    radial-gradient(circle at 50% 28%, rgba(214, 69, 69, .6), transparent 22%),
    radial-gradient(circle at 50% 70%, rgba(214, 69, 69, .6), transparent 22%),
    linear-gradient(180deg, rgba(29, 78, 87, .95), rgba(29, 78, 87, .75));
  box-shadow: inset 0 0 0 2px rgba(215, 184, 123, .35), 0 10px 20px rgba(0, 0, 0, .25);
  position: relative;
}

.sidebar-toggle .flute::after {
  content: "";
  position: absolute;
  bottom: -14px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 18px;
  background: linear-gradient(180deg, rgba(214, 69, 69, 1), rgba(214, 69, 69, .1));
  border-radius: 8px;
  filter: blur(.3px);
  animation: tassel 2.4s ease-in-out infinite;
}

@keyframes tassel {
  50% {
    transform: translateX(-50%) rotate(2deg)
  }
}

/* 背景遮罩（点击关闭侧栏用） */
.backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, .25);
  z-index: 15
}

/* 档位降载（JS 会按设备与掉帧加类） */
.perf-low .fx-clouds.front {
  display: none
}

.perf-low .fx-water {
  display: none
}

.perf-low .fx-moon {
  animation: none;
  opacity: .24
}

.perf-low .card-frame::before {
  animation-duration: 30s
}

.perf-low .event.chance {
  animation: none
}

.perf-low .action-tags li::after {
  animation: none
}

.perf-low .stat-bars li {
  background:
    linear-gradient(90deg, rgba(29, 78, 87, .6), rgba(29, 78, 87, .36)) left/var(--p) 100% no-repeat,
    rgba(255, 255, 255, .1)
}

/* 超低：掉帧保险丝 */
.perf-ultra .fx,
.perf-ultra #petals {
  display: none !important
}

.perf-ultra .card::before {
  backdrop-filter: none
}

.perf-ultra .card-frame {
  background: rgba(255, 255, 255, .92)
}

.perf-ultra .block::before {
  background: rgba(255, 255, 255, 0.721)
}

.perf-ultra .card-frame::before {
  animation: none
}

/* 系统“减少动效”优先 */
@media (prefers-reduced-motion:reduce) {
  * {
    animation: none !important;
    transition: none !important
  }

  .fx,
  .fx-petals {
    display: none !important
  }
}